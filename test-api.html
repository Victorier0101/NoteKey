<!DOCTYPE html>
<html>
<head>
  <title>Test Gemini API</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    button { padding: 10px 20px; font-size: 16px; margin: 5px; cursor: pointer; }
    pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
    .model-item { padding: 5px; border-bottom: 1px solid #ddd; }
  </style>
</head>
<body>
  <h1>Gemini API Model Finder</h1>
  <button onclick="listModels()">1. LIST ALL MODELS</button>
  <button onclick="testAPI()">2. Test Selected Model</button>
  <hr>
  <pre id="result">Click "LIST ALL MODELS" first to see available models...</pre>
  
  <script>
    const apiKey = 'AIzaSyDyIEKEfn75nZYx-gpx5HBAwyS-B8b4ZvQ';
    let selectedModel = null;
    
    async function listModels() {
      document.getElementById('result').textContent = 'Fetching available models...';
      
      try {
        // Try v1 endpoint
        const response = await fetch(`https://generativelanguage.googleapis.com/v1/models?key=${apiKey}`);
        
        if (!response.ok) {
          const error = await response.json();
          document.getElementById('result').textContent = 
            'Error ' + response.status + ':\n' + JSON.stringify(error, null, 2);
          return;
        }
        
        const data = await response.json();
        
        if (data.models && data.models.length > 0) {
          let output = '=== AVAILABLE MODELS ===\n\n';
          
          // Find models that support generateContent
          const generateModels = data.models.filter(m => 
            m.supportedGenerationMethods && 
            m.supportedGenerationMethods.includes('generateContent')
          );
          
          output += `Found ${generateModels.length} models that support generateContent:\n\n`;
          
          generateModels.forEach((model, index) => {
            output += `${index + 1}. ${model.name}\n`;
            output += `   Display Name: ${model.displayName}\n`;
            output += `   Description: ${model.description}\n`;
            output += `   Supported: ${model.supportedGenerationMethods.join(', ')}\n\n`;
          });
          
          // Use the first available model
          if (generateModels.length > 0) {
            selectedModel = generateModels[0].name;
            output += `\n✅ WILL USE: ${selectedModel}\n`;
            output += `\nNow click "Test Selected Model" to test it!`;
          }
          
          document.getElementById('result').textContent = output;
        } else {
          document.getElementById('result').textContent = 'No models found!';
        }
      } catch (error) {
        document.getElementById('result').textContent = 
          'Network Error:\n' + error.message;
      }
    }
    
    async function testAPI() {
      if (!selectedModel) {
        document.getElementById('result').textContent = 
          'Please click "LIST ALL MODELS" first!';
        return;
      }
      
      document.getElementById('result').textContent = 
        `Testing model: ${selectedModel}\n\nGenerating explanation...`;
      
      try {
        // selectedModel is like "models/gemini-2.5-flash", add v1/ before it
        const endpoint = `https://generativelanguage.googleapis.com/v1/${selectedModel}:generateContent?key=${apiKey}`;
        
        const response = await fetch(endpoint, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: "Explain what is a variable in programming in 2-3 sentences."
              }]
            }],
            generationConfig: {
              temperature: 0.7,
              maxOutputTokens: 200
            }
          })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          document.getElementById('result').textContent = 
            `❌ Error ${response.status}:\n\n` + JSON.stringify(data, null, 2);
        } else {
          const explanation = data.candidates[0].content.parts[0].text;
          document.getElementById('result').textContent = 
            `✅ SUCCESS!\n\nModel: ${selectedModel}\n\nExplanation:\n${explanation}\n\n` +
            `Full Response:\n${JSON.stringify(data, null, 2)}`;
        }
      } catch (error) {
        document.getElementById('result').textContent = 
          `❌ Network Error:\n${error.message}`;
      }
    }
  </script>
</body>
</html>
